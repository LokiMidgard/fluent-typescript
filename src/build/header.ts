import dedent from 'dedent-js'

const bannerMessage = (
  '// This file is automatically generated.\n// Please do not change this file!\n\n'
)

const vanillaSupport = dedent`
  import { FluentBundle, FluentArgument } from '@fluent/bundle'

  declare global {
    interface FluentBundleTyped extends FluentBundle {
      getMessage<T extends MessagesKey>(id: T): Message<T>
      formatPattern: <T extends MessagesKey>(...args: PatternArguments<T>) => string
    }
  }
`

const i18NextSupport = dedent`
  import { FluentArgument } from '@fluent/bundle'
  import { TransProps } from 'react-i18next'

  declare module 'react-i18next' {
    interface UseTranslationResponsePatched extends Omit<UseTranslationResponse, 't'> {
      t: <T extends MessagesKey>(...args: PatternArguments<T>) => string
    }

    function useTranslation(ns?: Namespace, options?: UseTranslationOptions): UseTranslationResponsePatched
  }

  declare global {
    interface TransPropsTyped<E extends Element = HTMLDivElement> extends Omit<TransProps<E>, 'i18nKey'> {
      i18nKey: MessagesKey
    }

    function TypeTransTyped<E extends Element = HTMLDivElement>(props: TransPropsTyped<E>): React.ReactElement;
  }
`

const targetSupport: { [key in TargetsSupported]: string } = {
  vanilla: vanillaSupport,
  'react-18next': i18NextSupport,
}

const header = (target: TargetsSupported) => dedent`
  type Message<T extends MessagesKey> = {
    id: T
    value: T
    attributes: Record<string, T>
  }

  ${targetSupport[target]}
`

const buildHeader = (target: TargetsSupported) => `${bannerMessage}${header(target)}\n`

export default buildHeader
